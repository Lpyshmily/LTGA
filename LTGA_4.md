# LTGA_4

使用**NLOPT**优化器进行优化。

* [1st version](#20201126-1st-version)

* [2nd version](#20201127-2nd-version)

* [3rd version](#20201127-3rd-version)

* [4th version](#20201129-4th-version)

## 20201126 1st version

编写将引力辅助时间、引力辅助半径、`vout`的方向角作为3个优化变量的目标函数`GA_obj_nlopt()`。

以[0.87704,0.0,0.469045]为初值，用NLOPT优化器进行优化，共迭代64次，最终结果是[0.876915432598294,0.0,0.471101375017972]，剩余质量为15842.254755816450000kg。

换用一个较差的初值[0.5,0.5,0.5]，验证能否收敛到上述结果。

迭代82次，最终结果是[0.876959627917576,0.0,0.471123454181230]，剩余质量为15842.254754116961000kg。

NLOPT效果很好。

## 20201127 2nd version

将第一段轨迹末端相对于火星的相对速度的三个分量作为优化变量，求解两段燃料最优交会问题。

首先构造6变量的目标函数`GA_obj_nlopt_6()`

```c++
// x[6] 0-引力辅助时间 1-引力辅助半径 2-vout方向角 3-5 引力辅助前相对速度vin的3个分量
// 求解两段燃料最优交会问题
// 三个分量的变化范围均为0-1，对应以下不同含义
// 引力辅助时间指第引力辅助前第一段轨迹的转移时间，变化范围为[0.3,0.35]tf
// 引力辅助半径变化范围为[1,2]rmin
// vout方向角指vout和vin、vp组成的平面的夹角，变化范围为[0,pi]
// vin3个分量的变化范围均为[-0.1,0.1]
// para NULL
double GA_obj_nlopt_6(unsigned n, const double* x, double* grad, void* para)
```

用[1st version](#20201126-1st-version)中的结果进行测试，6变量的值为[0.876959627917576,0.0,0.471123454181230,0.201,0.3573,0.6245]。

测试成功，最终结果为15842.331kg。

## 20201127 3rd version

用NLOPT对6变量的目标函数进行优化。

以[0.876959627917576,0.0,0.471123454181230,0.201,0.3573,0.6245]为初值，共迭代98次，最终结果为[0.8754359,0.0,0.4370229,0.2028572463,0.3,0.623]，剩余质量为15855.175441277681kg。

> 在优化过程中，会出现最优转移时间满足条件，但是燃料最优不收敛的情况。

由于NLOPT进行的是局部优化，很可能是局部最优解，应该事先用PSO进行全局优化，再用PSO的结果作为初值进行局部优化。

## 20201129 4th version

* PSO优化

    运行结果为[0.999709099304766,0.004722508503925,0.470617494430747,0.239538394402327,0.275113612765333,0.666440534595599]，剩余质量为15889.122481630415kg。

    关于这个结果，衍生出两种想法：

    1. 第一个变量约等于1，说明引力辅助时间非常接近给定的上限值0.35，这意味着最优的引力辅助时间可能超过这个上限，而且根据已知的最优解，引力辅助时间为0.3876，确实超过了当前引力辅助时间的范围。
    
        解决方法是：引力辅助时间的搜索范围扩大，从原来的[0.3,0.35]扩大到[0.3,0.4]。在函数`GA_obj_PSO_6_new()`和`GA_PSO_6_new()`中进行实现。（目前还没有运行）

    2. 对当前的最优解进行验证，分别用`GA_obj_PSO_6()`和`GA_obj_PSO_6_new()`进行验证，第一次燃料最优交会问题随机猜测100次很难收敛，增加最大随机猜测次数可以收敛。
    
        > 这个问题在[3rd verion](#20201127-3rd-version)中也遇到过。
        
        为了解决这一问题，将随机猜测次数增加到1000次，并计划用春分点轨道根数代替直角坐标进行求解。